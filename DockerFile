# ----- Stage 1: The Build Stage -----
# Use a Maven image with Java 11 to build the project
FROM maven:3.8.5-jdk-11 AS build

# Set the working directory inside the container
WORKDIR /app

# Copy the pom.xml first to leverage Docker layer caching
COPY pom.xml .
# Download dependencies
RUN mvn dependency:go-offline

# Copy the rest of the source code
COPY src ./src

# Build the project and create the .war file. Skip tests to build faster.
RUN mvn clean package -DskipTests

# ----- Stage 2: The Runtime Stage -----
# Use a Tomcat image to run the application
FROM tomcat:9.0-jdk11-temurin

# Remove the default Tomcat application
RUN rm -rf /usr/local/tomcat/webapps/ROOT

# Copy the .war file built in Stage 1 from its target directory
# We must use the correct .war file name (check your pom.xml)
# I am assuming it is 'StudyMaterialPlatform.war'
COPY --from=build /app/target/StudyMaterialPlatform.war /usr/local/tomcat/webapps/ROOT.war

# Final comment to force re-build
